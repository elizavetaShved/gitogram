import{q,s as G,$ as L,_ as A,o as l,c as u,a as d,u as j,t as Q,k as X,w as R,I as J,v as Y,x as Z,S as ee,y as te,z as se,N as ie,P as ne,R as T,r as S,e as H,A as M,F as K,f as oe,h as W,n as U,i as P,p as re,b as ae}from"./index.0907dd76.js";function le({swiper:e,extendParams:o,on:i,emit:p}){const n=q(),r=G();e.keyboard={enabled:!1},o({keyboard:{enabled:!1,onlyInViewport:!0,pageUpDown:!0}});function g(I){if(!e.enabled)return;const{rtlTranslate:s}=e;let t=I;t.originalEvent&&(t=t.originalEvent);const c=t.keyCode||t.charCode,D=e.params.keyboard.pageUpDown,_=D&&c===33,h=D&&c===34,v=c===37,m=c===39,b=c===38,y=c===40;if(!e.allowSlideNext&&(e.isHorizontal()&&m||e.isVertical()&&y||h)||!e.allowSlidePrev&&(e.isHorizontal()&&v||e.isVertical()&&b||_))return!1;if(!(t.shiftKey||t.altKey||t.ctrlKey||t.metaKey)&&!(n.activeElement&&n.activeElement.nodeName&&(n.activeElement.nodeName.toLowerCase()==="input"||n.activeElement.nodeName.toLowerCase()==="textarea"))){if(e.params.keyboard.onlyInViewport&&(_||h||v||m||b||y)){let E=!1;if(e.$el.parents(`.${e.params.slideClass}`).length>0&&e.$el.parents(`.${e.params.slideActiveClass}`).length===0)return;const $=e.$el,C=$[0].clientWidth,N=$[0].clientHeight,F=r.innerWidth,O=r.innerHeight,a=e.$el.offset();s&&(a.left-=e.$el[0].scrollLeft);const V=[[a.left,a.top],[a.left+C,a.top],[a.left,a.top+N],[a.left+C,a.top+N]];for(let x=0;x<V.length;x+=1){const f=V[x];if(f[0]>=0&&f[0]<=F&&f[1]>=0&&f[1]<=O){if(f[0]===0&&f[1]===0)continue;E=!0}}if(!E)return}e.isHorizontal()?((_||h||v||m)&&(t.preventDefault?t.preventDefault():t.returnValue=!1),((h||m)&&!s||(_||v)&&s)&&e.slideNext(),((_||v)&&!s||(h||m)&&s)&&e.slidePrev()):((_||h||b||y)&&(t.preventDefault?t.preventDefault():t.returnValue=!1),(h||y)&&e.slideNext(),(_||b)&&e.slidePrev()),p("keyPress",c)}}function w(){e.keyboard.enabled||(L(n).on("keydown",g),e.keyboard.enabled=!0)}function k(){!e.keyboard.enabled||(L(n).off("keydown",g),e.keyboard.enabled=!1)}i("init",()=>{e.params.keyboard.enabled&&w()}),i("destroy",()=>{e.keyboard.enabled&&k()}),Object.assign(e.keyboard,{enable:w,disable:k})}const z=0,B=100,de=40;const ce={name:"slide-header",props:["progressPercent","index","slideActive","owner"],computed:{getProgressPercent(){return this.index===this.slideActive?this.progressPercent:this.index<this.slideActive?B:z}}},_e={class:"slide-header"},he={class:"slide-header__rate-wrapper"},ue=["href"],pe=["src","alt"],fe={class:"slide-header__login"};function ve(e,o,i,p,n,r){return l(),u("div",_e,[d("div",he,[d("div",{class:"slide-header__rate",style:j({width:`${r.getProgressPercent}%`})},null,4)]),d("a",{href:i.owner.htmlUrl,class:"slide-header__user-info",target:"_blank"},[d("img",{src:i.owner.avatarUrl,alt:i.owner.login,class:"slide-header__avatar"},null,8,pe),d("div",fe,Q(i.owner.login),1)],8,ue)])}const me=A(ce,[["render",ve],["__scopeId","data-v-8bed079c"]]);const ge={name:"c-skeleton"},we={class:"skeleton"},ke=X('<div class="skeleton__item skeleton__item--width-full skeleton__item--height-big" data-v-477b7567></div><div class="skeleton__strokes-wrapper" data-v-477b7567><div class="skeleton__item skeleton__item--width-middle" data-v-477b7567></div><div class="skeleton__item skeleton__item--width-big" data-v-477b7567></div><div class="skeleton__item skeleton__item--width-small" data-v-477b7567></div></div><div class="skeleton__strokes-wrapper" data-v-477b7567><div class="skeleton__item skeleton__item--width-middle" data-v-477b7567></div><div class="skeleton__item skeleton__item--width-big" data-v-477b7567></div><div class="skeleton__item skeleton__item--width-small" data-v-477b7567></div></div>',3),be=[ke];function ye(e,o,i,p,n,r){return l(),u("div",we,be)}const Se=A(ge,[["render",ye],["__scopeId","data-v-477b7567"]]),Pe=4.5,Ie=3.5,xe=1,Re=()=>{const e=R().value===J||R().value===Y,o=R().value===Z;return e?Pe:o?Ie:xe};const Ae={name:"stories-page",components:{CSkeleton:Se,SlideHeader:me,Swiper:ee,SwiperSlide:te},data(){return{swiper:void 0,slideActive:0,progressPercent:0,progressInterval:0}},setup(){return{store:se(),modules:[ie,ne,le]}},methods:{onSwiper(e){this.swiper=e,this.store.popularRepos.length?(this.setDefaultSlide(),this.startTimerAutoFlipping()):this.fetchMore(!0)},slideChange(){this.slideActive=this.swiper.activeIndex,this.getReadme();const e=this.store.popularRepos[this.swiper.activeIndex].id;this.$router.push({query:{[T.id]:e}}),this.store.popularRepos.length-this.slideActive<=3&&this.fetchMore()},setDefaultSlide(){const e=+this.$route.query[T.id],o=this.store.popularRepos.findIndex(i=>i.id===e);this.swiper.slideTo(o)},startTimerAutoFlipping(){this.progressPercent=z,clearInterval(this.progressInterval),this.swiper.destroyed||(this.progressInterval=setInterval(()=>{this.progressPercent++,this.progressPercent===B&&this.swiper.slideNext()},de))},fetchMore(e){this.store.fetchMorePopularRepos().then(()=>{e&&this.store.popularRepos.length&&this.setDefaultSlide(),this.store.totalCount&&this.store.popularRepos.length===this.store.totalCount&&clearInterval(this.progressInterval)})},getReadme(){const e=this.swiper.activeIndex,o=this.store.popularRepos[e].owner.login,i=this.store.popularRepos[e].name;this.progressPercent=0,clearInterval(this.progressInterval),this.store.fetchReadmeRepo(e,o,i).then(()=>{this.startTimerAutoFlipping()})}},computed:{getSlidePerView(){return Re()}}},De=e=>(re("data-v-35300982"),e=e(),ae(),e),Ee={class:"stories stories-preview-swiper"},$e={class:"stories__page-content"},Ce=["innerHTML"],Ne={key:1,class:"stories__info-error"},Ve=De(()=>d("div",{class:"stories__btn-follow-wrapper"},[d("button",{type:"button",class:"stories__btn-follow btn"}," Follow ")],-1));function Le(e,o,i,p,n,r){const g=S("slide-header"),w=S("c-skeleton"),k=S("swiper-slide"),I=S("swiper");return l(),u("div",Ee,[d("div",$e,[H(I,{modules:p.modules,"slides-per-view":r.getSlidePerView,"space-between":12,"centered-slides":!0,navigation:!0,keyboard:!0,onSwiper:r.onSwiper,onSlideChange:r.slideChange},{default:M(()=>[(l(!0),u(K,null,oe(p.store.popularRepos,(s,t)=>(l(),W(k,{key:s.id,class:U(["stories__item-wrapper",{active:n.slideActive===t}])},{default:M(()=>[H(g,{progressPercent:n.progressPercent,index:t,owner:s.owner,slideActive:n.slideActive},null,8,["progressPercent","index","owner","slideActive"]),d("div",{class:U(["stories__info",{["stories__info--small"]:s.readme}])},[s.readme?(l(),u(K,{key:0},[s.readme.data?(l(),u("div",{key:0,innerHTML:s.readme.data},null,8,Ce)):P("",!0),s.readme.err?(l(),u("div",Ne," \u041E\u0448\u0438\u0431\u043A\u0430 \u0437\u0430\u0433\u0440\u0443\u0437\u043A\u0438 ")):P("",!0)],64)):P("",!0),s.readme?P("",!0):(l(),W(w,{key:1}))],2),Ve]),_:2},1032,["class"]))),128))]),_:1},8,["modules","slides-per-view","onSwiper","onSlideChange"])])])}const He=A(Ae,[["render",Le],["__scopeId","data-v-35300982"]]);export{He as default};
